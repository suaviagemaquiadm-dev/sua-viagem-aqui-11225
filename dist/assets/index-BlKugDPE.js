import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as Y}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";import{getFirestore as Z,doc as H,getDoc as _,collection as D,query as W,where as j,getDocs as V}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{getFunctions as Q,httpsCallable as F}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-functions.js";import{getAuth as ee,onAuthStateChanged as te,signOut as ae}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";const se={apiKey:"AIzaSyAzrZ-gVFJXCevpEkKHht3dn9RLCRdo2h0",authDomain:"gemini-cli-98f4a.firebaseapp.com",projectId:"gemini-cli-98f4a",storageBucket:"gemini-cli-98f4a.firebasestorage.app",messagingSenderId:"1065949512661",appId:"1:1065949512661:web:57d184d86a82438511f35c",measurementId:"G-CHE4S36RY3"},S=Y(se),E=Z(S),z=Q(S,"southamerica-east1"),B=ee(S),G=document.getElementById("alert-modal"),oe=document.getElementById("alert-message"),ne=document.getElementById("alert-close-btn");function g(a){oe.textContent=a,G.classList.remove("hidden")}ne.addEventListener("click",()=>{G.classList.add("hidden")});const ie="suaviagemaqui.adm@gmail.com",h=document.getElementById("user-actions");te(B,a=>{if(a){h.innerHTML="";const t=document.createElement("a"),s=H(E,"partners",a.uid);if(_(s).then(e=>{e.exists()?t.href="painel_anunciante.html":t.href="perfil.html"}),t.className="flex items-center bg-slate-700 text-white px-4 py-2 rounded-full hover:bg-slate-600 transition-all",t.innerHTML='<i class="fas fa-user-circle text-lg mr-2"></i><span class="hidden sm:inline font-bold">Meu Painel</span>',h.appendChild(t),a.email===ie){const e=document.createElement("a");e.href="admin.html",e.className="flex items-center bg-purple-600 text-white px-4 py-2 rounded-full hover:bg-purple-700 transition-all",e.innerHTML='<i class="fas fa-user-shield mr-2"></i><span class="hidden sm:inline font-bold">Admin</span>',h.insertBefore(e,t)}const o=document.createElement("button");o.id="logout-btn",o.className="flex items-center bg-red-600 text-white px-4 py-2 rounded-full hover:bg-red-700 transition-all",o.innerHTML='<i class="fas fa-sign-out-alt text-lg mr-2"></i><span class="hidden sm:inline font-bold">Sair</span>',o.onclick=()=>{ae(B).then(()=>{window.location.reload()}).catch(console.error)},h.appendChild(o)}else h.innerHTML=`
                    <a href="cadastro_anunciantes.html" id="anuncie-btn" class="hidden md:flex items-center bg-transparent border border-amber-400 text-amber-400 px-4 py-2 rounded-full hover:bg-amber-400 hover:text-slate-900 transition-all">
                        <i class="fas fa-bullhorn mr-2"></i>
                        <span class="font-bold">Anuncie Seu Negócio</span>
                    </a>
                    <a href="pagina_login.html" id="login-btn" class="flex items-center bg-amber-500 text-slate-900 px-4 py-2 rounded-full hover:bg-amber-400 transition-all shadow-lg hover:shadow-amber-500/20">
                        <i class="fas fa-sign-in-alt text-lg mr-2"></i>
                        <span class="hidden sm:inline font-bold">Login</span>
                    </a>
                 `});new MercadoPago("APP_USR-02613eca-74a8-41c0-8800-044a325e5d15",{locale:"pt-BR"});const J=document.getElementById("search-results-section"),A=document.getElementById("search-results-grid"),N=document.getElementById("no-results-message"),U=document.getElementById("main-content"),O=document.getElementById("hero-section"),re=document.getElementById("clear-search-btn"),M=document.getElementById("search-destino-btn"),$=document.getElementById("search-categoria-btn");async function X({destino:a="",categoria:t=""},s){const o=s.querySelector(".search-text"),e=s.querySelector(".search-loading");o.classList.add("hidden"),e.classList.remove("hidden"),e.classList.add("flex"),s.disabled=!0;try{const c=D(E,"partners"),m=W(c,j("status","==","aprovado")),r=await V(m),n=[];r.forEach(i=>{n.push({id:i.id,...i.data()})});const d=a.toLowerCase().trim(),u=n.filter(i=>{var P,k,C;const l=t==="todos"||t===""||i.category===t,p=[((P=i.businessName)==null?void 0:P.toLowerCase())||"",((k=i.city)==null?void 0:k.toLowerCase())||"",((C=i.state)==null?void 0:C.toLowerCase())||"",...i.tags||[]].join(" "),K=d===""||p.includes(d);return l&&K});A.innerHTML="",u.length>0?(N.classList.add("hidden"),u.forEach(i=>{const l=document.createElement("a");l.href=`public_partner_details.html?id=${i.id}`,l.className="bg-slate-800 rounded-2xl overflow-hidden flex flex-col card-hover",l.innerHTML=`
                            <img src="${i.image||"https://placehold.co/400x300/1e293b/fcd34d?text=SVA"}" alt="${i.businessName}" class="w-full h-48 object-cover">
                            <div class="p-4 flex flex-col flex-grow">
                                <h3 class="text-lg font-bold text-white">${i.businessName}</h3>
                                <p class="text-sm text-amber-400 capitalize">${i.category.replace(/_/g," ")}</p>
                                <p class="text-xs text-slate-400 mt-2"><i class="fas fa-map-marker-alt mr-2"></i>${i.city}, ${i.state}</p>
                            </div>
                        `,A.appendChild(l)})):N.classList.remove("hidden"),U.classList.add("hidden"),O.classList.add("hidden"),J.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"})}catch(c){console.error("Erro ao buscar dados do Firebase: ",c),g("Não foi possível conectar à base de dados. Verifique o console para mais detalhes.")}finally{o.classList.remove("hidden"),e.classList.add("hidden"),e.classList.remove("flex"),s.disabled=!1}}M.addEventListener("click",()=>{const a=document.getElementById("destino-input").value;X({destino:a},M)});$.addEventListener("click",()=>{const a=document.getElementById("categoria-select").value,t=document.getElementById("local-input").value;X({destino:t,categoria:a},$)});re.addEventListener("click",()=>{J.classList.add("hidden"),U.classList.remove("hidden"),O.classList.remove("hidden"),document.getElementById("destino-input").value="",document.getElementById("local-input").value="",document.getElementById("categoria-select").value="todos"});const x=document.getElementById("weather-widget");async function le(){const a=F(z,"getWeatherForecast");try{const s=(await a()).data;if(!s||!s.city){x.innerHTML='<div class="text-center text-slate-400 w-full">Dados de previsão indisponíveis.</div>';return}const o=s.list.filter(n=>n.dt_txt.includes("12:00:00"));if(!o.length){x.innerHTML='<div class="text-center text-slate-400 w-full">Dados de previsão indisponíveis.</div>';return}const e=o[0],c=T(e.weather[0].id),m=Math.round(e.main.temp);let r=`
                    <div class="flex items-center space-x-4 flex-1">
                        <div>
                            <p class="text-lg font-semibold text-white">${s.city.name}</p>
                            <p class="text-sm text-slate-300">Hoje</p>
                        </div>
                        <div class="text-right">
                            <i class="fas ${c} text-4xl text-amber-400"></i>
                            <p class="text-3xl font-bold text-white">${m}°C</p>
                        </div>
                    </div>
                    <div class="border-l border-slate-600 pl-4 flex space-x-4">
                `;for(let n=1;n<3&&n<o.length;n++){const d=o[n],u=new Date(d.dt*1e3).toLocaleDateString("pt-BR",{weekday:"short"}),i=T(d.weather[0].id),l=Math.round(d.main.temp);r+=`
                        <div class="text-center">
                            <p class="font-semibold text-white">${u}</p>
                            <i class="fas ${i} text-2xl text-slate-300 my-1"></i>
                            <p class="font-bold text-white">${l}°</p>
                        </div>
                    `}r+="</div>",x.innerHTML=r}catch(t){console.error("Erro ao buscar previsão do tempo:",t),x.innerHTML='<div class="text-center text-slate-400 w-full">Não foi possível carregar a previsão do tempo.</div>'}}function T(a){return a>=200&&a<300?"fa-bolt":a>=300&&a<400?"fa-cloud-rain":a>=500&&a<600?"fa-cloud-showers-heavy":a>=600&&a<700?"fa-snowflake":a>=700&&a<800?"fa-smog":a===800?"fa-sun":a===801?"fa-cloud-sun":a>801?"fa-cloud":"fa-question-circle"}le();const q=[{text:"A",name:"Agência Alpha",desc:"Especialistas em viagens de luxo e experiências exclusivas."},{text:"B",name:"Beta Travel",desc:"Foco em destinos exóticos e aventuras inesquecíveis."},{text:"G",name:"Gamma Corp",desc:"Soluções completas para viagens corporativas e de incentivo."},{text:"D",name:"Delta Viagens",desc:"Curadoria de roteiros culturais e históricos pelo mundo."},{text:"E",name:"Epsilon Tours",desc:"Viagens de bem-estar e retiros espirituais."}],w=document.getElementById("advertiser-grid");function L(a){w.innerHTML="",a.forEach(t=>{const s=document.createElement("a");s.href=`public_partner_details.html?id=${t.id}`,s.className="bg-slate-800 rounded-2xl overflow-hidden flex flex-col card-hover";const o=document.createElement("div");o.className="relative w-full h-48";const e=t.galleryImages&&t.galleryImages.length>0?t.galleryImages:[t.image];e.slice(0,5).forEach((m,r)=>{const n=document.createElement("img");n.src=m||"https://placehold.co/400x300/1e293b/fcd34d?text=SVA",n.alt=t.businessName,n.className=`absolute top-0 left-0 w-full h-full object-cover advertiser-card-image transition-opacity duration-500 ${r===0?"opacity-100":"opacity-0"}`,o.appendChild(n)}),s.dataset.currentImageIndex="0",s.dataset.totalImages=e.slice(0,5).length;const c=document.createElement("div");c.className="p-4 flex flex-col flex-grow",c.innerHTML=`
                    <h3 class="text-lg font-bold text-white">${t.businessName}</h3>
                    <p class="text-sm text-amber-400 capitalize">${(t.category||"").replace(/_/g," ")}</p>
                    <p class="text-xs text-slate-400 mt-2"><i class="fas fa-map-marker-alt mr-2"></i>${t.city}, ${t.state}</p>
                `,s.appendChild(o),s.appendChild(c),w.appendChild(s)}),setInterval(()=>{w.querySelectorAll(".card-hover").forEach(s=>{const o=s.querySelector(".relative.w-full.h-48");if(o){const e=o.querySelectorAll("img"),c=parseInt(s.dataset.totalImages,10);if(c>1){let m=parseInt(s.dataset.currentImageIndex,10);e[m].classList.remove("opacity-100"),e[m].classList.add("opacity-0");let r=(m+1)%c;e[r].classList.remove("opacity-0"),e[r].classList.add("opacity-100"),s.dataset.currentImageIndex=r.toString()}}})},4e3)}async function ce(){if(w)try{const a=D(E,"partners"),t=W(a,j("status","==","aprovado")),s=await V(t);let o=[];if(s.forEach(e=>{o.push({id:e.id,...e.data()})}),o.length>0){const c=o.sort(()=>.5-Math.random()).slice(0,8);L(c)}else L([{id:"mock1",businessName:"Passeio de Barco Ilha Bela",category:"passeios_barco",city:"Ilhabela",state:"SP",image:"https://images.unsplash.com/photo-1590523741831-ab7e8b8f9c7f?w=500"},{id:"mock2",businessName:"Trilha da Cachoeira",category:"ecoturismo",city:"Ubatuba",state:"SP",image:"https://images.unsplash.com/photo-1532274402911-5a369e4c4bb5?w=500"},{id:"mock3",businessName:"Pousada Vista Mar",category:"hospedagem",city:"Paraty",state:"RJ",image:"https://images.unsplash.com/photo-1566073771259-6a8506099945?w=500"},{id:"mock4",businessName:"Restaurante Caiçara",category:"restaurantes",city:"Caraguatatuba",state:"SP",image:"https://images.unsplash.com/photo-1552566626-52f8b828add9?w=500"},{id:"mock5",businessName:"Aluguel de Bikes Litoral",category:"aluguel",city:"São Sebastião",state:"SP",image:"https://images.unsplash.com/photo-1507035895480-2b3156c31fc8?w=500"},{id:"mock6",businessName:"Guia Histórico Paraty",category:"guias",city:"Paraty",state:"RJ",image:"https://images.unsplash.com/photo-1533106418989-88406e76827a?w=500"},{id:"mock7",businessName:"Bar da Praia",category:"bares",city:"Ubatuba",state:"SP",image:"https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=500"},{id:"mock8",businessName:"Experiência de Mergulho",category:"mergulho",city:"Ilhabela",state:"SP",image:"https://images.unsplash.com/photo-1577451996136-eb2fde781666?w=500"}])}catch(a){console.error("Erro ao carregar parceiros:",a),L([{id:"mock1",businessName:"Passeio de Barco Ilha Bela",category:"passeios_barco",city:"Ilhabela",state:"SP",image:"https://images.unsplash.com/photo-1590523741831-ab7e8b8f9c7f?w=500"},{id:"mock2",businessName:"Trilha da Cachoeira",category:"ecoturismo",city:"Ubatuba",state:"SP",image:"https://images.unsplash.com/photo-1532274402911-5a369e4c4bb5?w=500"},{id:"mock3",businessName:"Pousada Vista Mar",category:"hospedagem",city:"Paraty",state:"RJ",image:"https://images.unsplash.com/photo-1566073771259-6a8506099945?w=500"},{id:"mock4",businessName:"Restaurante Caiçara",category:"restaurantes",city:"Caraguatatuba",state:"SP",image:"https://images.unsplash.com/photo-1552566626-52f8b828add9?w=500"},{id:"mock5",businessName:"Aluguel de Bikes Litoral",category:"aluguel",city:"São Sebastião",state:"SP",image:"https://images.unsplash.com/photo-1507035895480-2b3156c31fc8?w=500"},{id:"mock6",businessName:"Guia Histórico Paraty",category:"guias",city:"Paraty",state:"RJ",image:"https://images.unsplash.com/photo-1533106418989-88406e76827a?w=500"},{id:"mock7",businessName:"Bar da Praia",category:"bares",city:"Ubatuba",state:"SP",image:"https://images.unsplash.com/photo-1514933651103-005eec06c04b?w=500"},{id:"mock8",businessName:"Experiência de Mergulho",category:"mergulho",city:"Ilhabela",state:"SP",image:"https://images.unsplash.com/photo-1577451996136-eb2fde781666?w=500"}])}}ce();const de=[{img:"https://placehold.co/50x50/fcd34d/1f2937?text=M",alt:"Maria S.",name:"Maria S.",title:"Pousada Aconchego",quote:'"Desde que entramos na plataforma, nossa taxa de ocupação aumentou em 30%. O acesso direto às agências premium fez toda a diferença!"'},{img:"https://placehold.co/50x50/fcd34d/1f2937?text=A",alt:"Ana L.",name:"Ana L.",title:"Viajante Verificada",quote:'"Encontrei um guia de turismo local incrível através da plataforma para o meu passeio na Amazônia. Foi uma experiência autêntica que eu não teria achado em nenhum outro lugar!"'},{img:"https://placehold.co/50x50/fcd34d/1f2937?text=J",alt:"João P.",name:"João P.",title:"Guia de Ecoturismo",quote:'"A visibilidade que o plano Basic me deu foi incrível. Recebo contatos de agências que antes eu nem sonhava em alcançar. Recomendo!"'},{img:"https://placehold.co/50x50/fcd34d/1f2937?text=C",alt:"Carlos F.",name:"Carlos F.",title:"Viajante Verificado",quote:'"Planejei toda a minha viagem de lua de mel usando os parceiros da plataforma. Desde a pousada romântica até os restaurantes, tudo foi perfeito. Facilitou muito a minha vida."'}],b=document.getElementById("carousel-track");if(b){let d=function(l=!1){if(l&&i(),o.length>0){const p=o[0].getBoundingClientRect().width;b.style.transform=`translateX(-${e*p}px)`}t.disabled=e===0,s.disabled=e>=n,l&&u()},u=function(){i(),c=setInterval(()=>{e=e>=n?0:e+1,d()},5e3)},i=function(){clearInterval(c)};q.sort(()=>Math.random()-.5),q.forEach(l=>{const p=document.createElement("div");p.className="carousel-slide min-w-full md:min-w-1/2 lg:min-w-1/3 p-4",p.innerHTML=`
                    <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 h-full text-center hover:border-amber-400 transition-colors">
                        <img src="https://placehold.co/100x100/1f2937/fcd34d?text=${l.text}" alt="Logo ${l.name}" class="h-20 w-20 mx-auto mb-6 rounded-full object-cover border-2 border-slate-600">
                        <h3 class="text-xl font-bold text-white">${l.name}</h3>
                        <p class="text-slate-400 mt-2">${l.desc}</p>
                    </div>
                `,b.appendChild(p)});const a=document.getElementById("agencies-carousel-wrapper"),t=document.getElementById("prev-btn"),s=document.getElementById("next-btn"),o=b.querySelectorAll(".carousel-slide");let e=0,c;const m=()=>window.innerWidth>=1024?3:window.innerWidth>=768?2:1,r=()=>o.length-m();let n=r();s.addEventListener("click",()=>{e<n&&e++,d(!0)}),t.addEventListener("click",()=>{e>0&&e--,d(!0)}),a.addEventListener("mouseenter",i),a.addEventListener("mouseleave",u),window.addEventListener("resize",()=>{n=r(),e>n&&(e=n),d()}),d(),u()}const f=document.getElementById("partners-carousel-track");if(f){let c=function(){m(),e=setInterval(()=>{t.scrollLeft>=f.scrollWidth/2?t.scrollLeft=0:t.scrollBy({left:1,behavior:"auto"})},30)},m=function(){clearInterval(e)};[...partnersData,...partnersData].forEach(r=>{const n=Array(5).fill(0).map((u,i)=>`<i class="fas fa-star ${i<r.rating?"text-amber-400":"text-slate-600"}"></i>`).join(""),d=document.createElement("div");d.className="flex-none w-full sm:w-1/2 md:w-1/3 lg:w-1/4 xl:w-1/5 p-3",d.innerHTML=`
                    <div class="bg-slate-800 rounded-2xl overflow-hidden h-full flex flex-col card-hover">
                        <img src="${r.img}" class="w-full h-48 object-cover">
                        <div class="p-4 flex flex-col flex-grow">
                            <h3 class="text-lg font-bold text-white">${r.title}</h3>
                            <p class="text-sm text-slate-400 mb-2">${r.category}</p>
                            <div class="flex items-center text-sm">${n}</div>
                        </div>
                    </div>
                `,f.appendChild(d)});const t=document.getElementById("partners-carousel-container"),s=document.getElementById("partners-prev-btn"),o=document.getElementById("partners-next-btn");let e;o.addEventListener("click",()=>{const r=f.querySelector("div").offsetWidth;t.scrollBy({left:r,behavior:"smooth"})}),s.addEventListener("click",()=>{const r=f.querySelector("div").offsetWidth;t.scrollBy({left:-r,behavior:"smooth"})}),t.addEventListener("mouseenter",m),t.addEventListener("mouseleave",startAutoScroll),c()}const v=document.getElementById("testimonials-track");if(v){let d=function(l=!1){if(l&&i(),o.length>0){const p=o[0].getBoundingClientRect().width;v.style.transform=`translateX(-${e*p}px)`}t.disabled=e===0,s.disabled=e>=n,l&&u()},u=function(){i(),c=setInterval(()=>{e=e>=n?0:e+1,d()},6e3)},i=function(){clearInterval(c)};de.forEach(l=>{const p=document.createElement("div");p.className="carousel-slide min-w-full md:min-w-1/2 p-4",p.innerHTML=`
                    <div class="bg-slate-800 p-8 rounded-2xl border border-slate-700 h-full flex flex-col">
                        <p class="text-slate-300 flex-grow"><em>${l.quote}</em></p>
                        <div class="flex items-center mt-6">
                            <img src="${l.img}" alt="${l.alt}" class="w-12 h-12 rounded-full mr-4">
                            <div>
                                <p class="font-bold text-white">${l.name}</p>
                                <p class="text-sm text-slate-400">${l.title}</p>
                            </div>
                        </div>
                    </div>
                `,v.appendChild(p)});const a=document.getElementById("testimonials-carousel-wrapper"),t=document.getElementById("testimonials-prev-btn"),s=document.getElementById("testimonials-next-btn"),o=v.querySelectorAll(".carousel-slide");let e=0,c;const m=()=>window.innerWidth>=768?2:1,r=()=>o.length-m();let n=r();s.addEventListener("click",()=>{e<n&&e++,d(!0)}),t.addEventListener("click",()=>{e>0&&e--,d(!0)}),a.addEventListener("mouseenter",i),a.addEventListener("mouseleave",u),window.addEventListener("resize",()=>{n=r(),e>n&&(e=n),d()}),d(),u()}const I=document.getElementById("generate-ai-btn"),me=document.getElementById("ai-prompt"),R=document.getElementById("ai-btn-text"),y=document.getElementById("ai-btn-loading");I.addEventListener("click",async()=>{const a=B.currentUser;if(!a){g("Por favor, faça login como viajante para usar esta funcionalidade."),window.location.href="pagina_login.html?redirectTo="+encodeURIComponent(window.location.href);return}const t=await _(H(E,"users",a.uid));if(!t.exists()||t.data().role!=="traveler_plus"||t.data().payment_status!=="paid"){g("Esta é uma funcionalidade exclusiva para Viajantes Plus. Por favor, assine o plano para continuar."),window.location.href="cadastro_viajante_plus.html";return}const s=me.value;if(!s.trim()){g("Por favor, descreva a viagem desejada para gerar o roteiro.");return}R.classList.add("hidden"),y.classList.remove("hidden"),y.classList.add("flex"),I.disabled=!0;try{const e=await F(z,"generateRoteiro")({prompt:s}),{roteiroId:c}=e.data;window.open(`public_roteiro.html?id=${c}`,"_blank")}catch(o){console.error("Erro ao gerar roteiro:",o),g("Ocorreu um erro ao gerar o roteiro. Tente novamente.")}finally{R.classList.remove("hidden"),y.classList.add("hidden"),y.classList.remove("flex"),I.disabled=!1}});
