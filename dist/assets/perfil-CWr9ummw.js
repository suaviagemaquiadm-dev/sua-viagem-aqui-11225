import"./modulepreload-polyfill-B5Qt9EMX.js";import{b as A,d as F,a as D,g as T,r as $,s as j,u as q,j as H,k as C}from"./main-DHtEt640.js";import"./layout-Bzk_Fs54.js";import{onAuthStateChanged as _}from"https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";const G=document.getElementById("loading-state"),r=document.getElementById("permission-denied"),b=document.getElementById("content-state"),E=document.getElementById("profile-view-container"),l=document.getElementById("profile-picture-view"),x=document.getElementById("user-name-view"),J=document.getElementById("user-email-view"),K=document.getElementById("user-control-code-view"),O=document.getElementById("edit-profile-btn"),h=document.getElementById("profile-edit-container"),Q=document.getElementById("profile-edit-form"),P=document.getElementById("profile-picture-edit"),W=document.getElementById("photo-upload"),U=document.getElementById("user-name-edit"),y=document.getElementById("save-profile-btn"),X=document.getElementById("cancel-edit-btn"),B=document.getElementById("upload-progress-container"),I=document.getElementById("upload-progress-bar"),v=document.getElementById("interests-view-container"),u=document.getElementById("interests-display"),Y=document.getElementById("no-interests-msg"),Z=document.getElementById("edit-interests-btn"),L=document.getElementById("interests-edit-container"),R=document.getElementById("interests-input"),ee=document.getElementById("save-interests-btn"),te=document.getElementById("cancel-interests-btn"),k=document.getElementById("alert-modal"),ne=document.getElementById("alert-message"),se=document.getElementById("alert-close-btn");let c=null,m=null,o=null;function d(e){ne.textContent=e,k.classList.remove("hidden")}function oe(){k.classList.add("hidden")}function a(e){G.classList.add("hidden"),r.classList.add("hidden"),b.classList.add("hidden"),e.classList.remove("hidden")}function de(e){x.textContent=e.name||"Nome não definido",J.textContent=e.email||"E-mail não disponível",l.src=e.photoURL||`https://ui-avatars.com/api/?name=${encodeURIComponent(e.name||"S")}&background=1f2937&color=fcd34d&size=128`,K.textContent=`Código: ${c.uid.substring(0,8).toUpperCase()}`,U.value=e.name||"",P.src=l.src,S(e.interests||[])}function S(e){u.innerHTML="",e.length===0?u.appendChild(Y):e.forEach(t=>{const n=document.createElement("span");n.className="bg-slate-700 text-cyan-300 text-sm font-medium px-3 py-1.5 rounded-full",n.textContent=t,u.appendChild(n)}),R.value=e.join(", ")}function f(e){e?(E.classList.add("hidden"),h.classList.remove("hidden")):(E.classList.remove("hidden"),h.classList.add("hidden"),o=null)}function g(e){e?(v.classList.add("hidden"),L.classList.remove("hidden")):(v.classList.remove("hidden"),L.classList.add("hidden"))}function w(e,t){const n=e.querySelector(".submit-text"),s=e.querySelector(".submit-loading");e.disabled=t,t?(n.classList.add("hidden"),s.classList.remove("hidden"),s.classList.add("flex")):(n.classList.remove("hidden"),s.classList.add("hidden"),s.classList.remove("flex"))}async function ie(e){e.preventDefault(),w(y,!0);const t=U.value;let n=l.src;try{if(o){B.classList.remove("hidden");const s=`profile-pictures/${c.uid}/${o.name}`,M=$(j,s),p=q(M,o);await new Promise((N,V)=>{p.on("state_changed",i=>{const z=i.bytesTransferred/i.totalBytes*100;I.style.width=z+"%"},i=>{V(i)},async()=>{n=await H(p.snapshot.ref),N()})})}await C(m,{name:t,photoURL:n}),l.src=n,x.textContent=t,d("Perfil atualizado com sucesso!"),f(!1)}catch(s){console.error("Error updating profile:",s),d("Falha ao atualizar o perfil. Tente novamente.")}finally{w(y,!1),B.classList.add("hidden"),I.style.width="0%",o=null}}async function ae(){const e=R.value.split(",").map(t=>t.trim()).filter(t=>t!=="");try{await C(m,{interests:e}),S(e),g(!1),d("Interesses atualizados com sucesso!")}catch(t){console.error("Error updating interests:",t),d("Falha ao atualizar os interesses.")}}O.addEventListener("click",()=>f(!0));X.addEventListener("click",()=>f(!1));Q.addEventListener("submit",ie);W.addEventListener("change",e=>{if(e.target.files&&e.target.files[0]){o=e.target.files[0];const t=new FileReader;t.onload=n=>{P.src=n.target.result},t.readAsDataURL(o)}});Z.addEventListener("click",()=>g(!0));te.addEventListener("click",()=>g(!1));ee.addEventListener("click",ae);se.addEventListener("click",oe);_(A,async e=>{if(e){c=e,m=F(D,"users",e.uid);try{const t=await T(m);t.exists()?(de(t.data()),a(b)):(d("Não foi possível encontrar os dados do seu perfil."),a(r))}catch(t){console.error("Error fetching user data:",t),d("Erro ao carregar os dados do perfil."),a(r)}}else c=null,a(r)});
