import"./modulepreload-polyfill-B5Qt9EMX.js";import{o as E,b as x,c as I,a as b,q as k,e as B,f as q,t as S,d as g,k as v}from"./main-DHtEt640.js";import"./layout-Bzk_Fs54.js";import{s}from"./alert-CuEEcBcm.js";document.addEventListener("DOMContentLoaded",()=>{const m=document.getElementById("loading-container"),n=document.getElementById("itineraries-grid"),p=document.getElementById("no-itineraries-message"),h=new showdown.Converter;let c=null;E(x,async e=>{e?(c=e.uid,await f(e.uid)):window.location.href="pagina_login.html"});async function f(e){try{const t=I(b,"users",e,"itineraries"),d=k(t,B("createdAt","desc")),a=await q(d);if(a.empty){m.classList.add("hidden"),p.classList.remove("hidden");return}n.innerHTML="",a.forEach(u=>{const o={id:u.id,...u.data()},r=y(o);n.appendChild(r)}),m.classList.add("hidden"),n.classList.remove("hidden")}catch(t){console.error("Erro ao carregar roteiros:",t),m.innerHTML='<p class="text-red-400">Não foi possível carregar seus roteiros.</p>'}}function y(e){var u;const t=document.createElement("div");t.className="glass-effect rounded-2xl p-6 flex flex-col justify-between card-hover";const d=e.public===!0;t.innerHTML=`
            <div>
                <h3 class="text-xl font-bold text-white truncate">${e.title}</h3>
                <p class="text-sm text-slate-400 mt-1">Criado em: ${new Date((u=e.createdAt)==null?void 0:u.toDate()).toLocaleDateString("pt-BR")}</p>
                <p class="text-sm text-slate-300 mt-4 line-clamp-3">${e.prompt}</p>
            </div>
            <div class="flex gap-2 mt-6 border-t border-slate-700 pt-4">
                <button class="view-btn flex-grow bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-2 px-4 rounded-lg transition" aria-label="Ver roteiro ${e.title}"><i class="fas fa-eye mr-2"></i>Ver</button>
                <button class="share-btn bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg transition" aria-label="Compartilhar roteiro ${e.title}"><i class="fas fa-share-alt"></i></button>
                 <button class="toggle-privacy-btn ${d?"bg-blue-600 hover:bg-blue-700":"bg-slate-600 hover:bg-slate-700"} text-white font-bold py-2 px-4 rounded-lg transition" aria-label="Tornar roteiro ${d?"privado":"público"}">
                    <i class="fas ${d?"fa-globe-americas":"fa-lock"}"></i>
                </button>
                <button class="delete-btn bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded-lg transition" aria-label="Excluir roteiro ${e.title}"><i class="fas fa-trash-alt"></i></button>
            </div>
        `,t.querySelector(".delete-btn").addEventListener("click",async()=>{if(confirm("Tem certeza que deseja excluir este roteiro?"))try{await S(g(b,"users",c,"itineraries",e.id)),t.remove(),s("Roteiro excluído com sucesso!"),n.children.length===0&&(n.classList.add("hidden"),p.classList.remove("hidden"))}catch(o){console.error("Erro ao excluir:",o),s("Não foi possível excluir o roteiro.")}}),t.querySelector(".share-btn").addEventListener("click",async()=>{const o=g(b,"users",c,"itineraries",e.id);if(!e.public){await v(o,{public:!0}),e.public=!0;const i=t.querySelector(".toggle-privacy-btn");i.classList.remove("bg-slate-600","hover:bg-slate-700"),i.classList.add("bg-blue-600","hover:bg-blue-700"),i.querySelector("i").classList.remove("fa-lock"),i.querySelector("i").classList.add("fa-globe-americas")}const r=`${window.location.origin}/roteiro_publico.html?user=${c}&id=${e.id}`;document.getElementById("share-link-input").value=r,document.getElementById("share-modal").classList.remove("hidden")});const a=t.querySelector(".toggle-privacy-btn");return a.addEventListener("click",async()=>{a.disabled=!0;const r=!(e.public===!0),i=g(b,"users",c,"itineraries",e.id);try{await v(i,{public:r}),e.public=r;const l=a.querySelector("i");r?(a.classList.remove("bg-slate-600","hover:bg-slate-700"),a.classList.add("bg-blue-600","hover:bg-blue-700"),l.classList.remove("fa-lock"),l.classList.add("fa-globe-americas"),a.setAttribute("aria-label","Tornar roteiro privado"),s("Roteiro agora é público.")):(a.classList.remove("bg-blue-600","hover:bg-blue-700"),a.classList.add("bg-slate-600","hover:bg-slate-700"),l.classList.remove("fa-globe-americas"),l.classList.add("fa-lock"),a.setAttribute("aria-label","Tornar roteiro público"),s("Roteiro agora é privado."))}catch(l){console.error("Erro ao alterar privacidade do roteiro:",l),s("Não foi possível alterar a privacidade. Tente novamente.")}finally{a.disabled=!1}}),t.querySelector(".view-btn").addEventListener("click",()=>{document.getElementById("itinerary-modal-title").textContent=e.title;const o=h.makeHtml(e.itineraryMarkdown);document.getElementById("itinerary-modal-body").innerHTML=o,document.getElementById("view-itinerary-modal").classList.remove("hidden")}),t}const L=document.getElementById("share-modal");document.getElementById("close-share-modal-btn").addEventListener("click",()=>L.classList.add("hidden")),document.getElementById("copy-link-btn").addEventListener("click",()=>{const e=document.getElementById("share-link-input");e.select(),navigator.clipboard.writeText(e.value).then(()=>{s("Link copiado para a área de transferência!")}).catch(t=>{console.error("Erro ao copiar o link:",t),s("Erro ao copiar. Tente manualmente.")})});const w=document.getElementById("view-itinerary-modal");document.getElementById("close-view-modal-btn").addEventListener("click",()=>w.classList.add("hidden"))});
