import"./modulepreload-polyfill-B5Qt9EMX.js";import"./layout-Bzk_Fs54.js";import{o as w,b as f,x,c as b,a as l,D as I,d as T,g as B,q as N,w as M,f as S}from"./main-DHtEt640.js";const $=new URLSearchParams(window.location.search),i=$.get("id");i||(window.location.href="404.html");let r=null;const d=document.getElementById("gallery-main-image"),m=document.getElementById("gallery-thumbnails"),A=document.getElementById("business-name"),C=document.getElementById("rating"),H=document.getElementById("location"),R=document.getElementById("category-badge"),u=document.getElementById("tags-container"),q=document.getElementById("description"),D=document.getElementById("contact-owner-btn"),p=document.getElementById("avg-rating"),g=document.getElementById("total-reviews"),c=document.getElementById("reviews-list"),v=document.getElementById("review-form"),s=document.getElementById("review-submit-btn"),k=document.getElementById("review-message"),O=document.getElementById("rating-input"),h=document.getElementById("review-form-container");function P(e){(!e||e.length===0)&&(e=["https://placehold.co/800x600/1e293b/fcd34d?text=Sem+Imagem"]),d.src=e[0],m.innerHTML="",e.forEach((a,t)=>{const n=document.createElement("img");n.src=a,n.className=`w-20 h-20 object-cover rounded-lg cursor-pointer border-2 ${t===0?"border-amber-500":"border-transparent hover:border-amber-400"}`,n.onclick=()=>{d.src=a,document.querySelectorAll("#gallery-thumbnails img").forEach(o=>o.classList.remove("border-amber-500")),n.classList.add("border-amber-500")},m.appendChild(n)})}function j(e){u.innerHTML="",e&&e.length>0&&e.forEach(a=>{const t=document.createElement("span");t.className="bg-slate-700 text-slate-300 text-xs font-medium px-2.5 py-1 rounded-full",t.innerText=a,u.appendChild(t)})}function F(e){if(c.innerHTML="",e&&e.length>0){const a=(e.reduce((t,n)=>t+n.rating,0)/e.length).toFixed(1);p.innerText=a,g.innerText=`${e.length} avaliações`,e.forEach(t=>{const n=document.createElement("div");n.className="p-5 border-t border-slate-700";const o=Array.from({length:5},(V,E)=>`<i class="fas fa-star ${E<t.rating?"text-amber-400":"text-slate-600"}"></i>`).join("");n.innerHTML=`
                <div class="flex items-center mb-2">
                    <div class="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center font-bold text-amber-400 mr-3">${t.authorName.charAt(0).toUpperCase()}</div>
                    <div>
                        <p class="font-bold text-white">${t.authorName}</p>
                        <div class="text-xs">${o}</div>
                    </div>
                </div>
                <p class="text-slate-400 leading-relaxed">${t.message}</p>
            `,c.appendChild(n)})}else p.innerText="N/A",g.innerText="Nenhuma avaliação ainda.",c.innerHTML='<p class="text-center p-8 text-slate-500">Seja o primeiro a avaliar!</p>'}function U(e,a,t){if(typeof L>"u")return;const n=L.map("map").setView([e,a],15);L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'}).addTo(n);const o=L.divIcon({className:"custom-map-marker",html:'<div class="p-2 bg-amber-500 rounded-full shadow-lg"><i class="fas fa-map-marker-alt text-slate-900"></i></div>',iconSize:[30,30],iconAnchor:[15,15]});L.marker([e,a],{icon:o}).addTo(n).bindPopup(`<b>${t}</b><br>Estamos aqui!`).openPopup()}async function _(){const e=T(l,"partners",i),a=await B(e);if(a.exists()){r=a.data(),A.innerText=r.businessName,C.innerText=r.rating||"Novo",H.innerText=`${r.city}, ${r.state}`,R.innerText=(r.category||"geral").replace(/_/g," "),q.innerHTML=r.description.replace(/\n/g,"<br>"),P(r.images),j(r.tags),D.href=`https://wa.me/55${r.phone.replace(/[^0-9]/g,"")}?text=Olá, vi seu anúncio na plataforma Sua Viagem Aqui e gostaria de mais informações.`;const t=r.latitude||-22.9068,n=r.longitude||-43.1729;U(t,n,r.businessName),await y()}else window.location.href="404.html"}async function y(){const e=N(b(l,"reviews"),M("partnerId","==",i)),a=await S(e),t=[];a.forEach(n=>{t.push(n.data())}),F(t)}async function z(e){e.preventDefault(),s.disabled=!0,s.innerHTML='<i class="fas fa-spinner fa-spin mr-2"></i> Enviando...';const a=f.currentUser;if(a)try{await x(b(l,"reviews"),{partnerId:i,userId:a.uid,authorName:a.displayName,rating:parseInt(O.value,10),message:k.value,createdAt:I()}),v.reset(),await y()}catch(t){console.error("Erro ao enviar avaliação: ",t),alert("Ocorreu um erro ao enviar sua avaliação.")}finally{s.disabled=!1,s.innerHTML="Enviar Avaliação"}}w(f,e=>{e?(h.classList.remove("hidden"),v.addEventListener("submit",z)):h.classList.add("hidden")});_();
